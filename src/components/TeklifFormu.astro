---
export interface FieldConfig {
  id: string;
  name: string;
  label: string;
  type: string;
  required?: boolean;
  options?: string[];
  colSpan?: number;
}

export interface Props {
  brandColor?: string;
  submitLabel?: string;
  formTitle: string;
  fields: FieldConfig[];
}

const {
  brandColor = "#4DA8DA",
  submitLabel = "Teklif Al",
  formTitle,
  fields = [],
} = Astro.props;
---

<style>
  .form-card {
    background: #f9fafb;
  }
  .input-base {
    transition:
      box-shadow 0.15s ease,
      transform 0.12s ease,
      border-color 0.15s ease;
    border: 2px solid transparent;
  }
  .input-base:focus {
    transform: translateY(-1px);
    outline: none;
    border-color: var(--focus-color);
    box-shadow: 0 0 0 3px var(--focus-ring);
  }
</style>

<div class="mt-12 p-8 rounded-lg shadow-xl form-card">
  <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
    {formTitle}
  </h2>

  <form id="teklifForm" class="space-y-6">
    <input
      type="hidden"
      name="_subject"
      value={`Yeni Teklif Formu: ${formTitle}`}
    />
    <input type="text" name="_honey" style="display:none" />

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {
        fields.map((field) => (
          <div class={field.colSpan === 2 ? "md:col-span-2" : ""}>
            <label
              for={field.id}
              class="block text-sm font-medium text-gray-700"
            >
              {field.label}
            </label>

            {field.type === "textarea" ? (
              <textarea
                id={field.id}
                name={field.name}
                rows="4"
                required={field.required}
                class="mt-1 block w-full px-4 py-2 rounded-md shadow-sm input-base"
                style={`--focus-color: ${brandColor}; --focus-ring: ${brandColor}33;`}
              />
            ) : field.type === "select" ? (
              <select
                id={field.id}
                name={field.name}
                required={field.required}
                class="mt-1 block w-full px-4 py-2 rounded-md shadow-sm input-base"
                style={`--focus-color: ${brandColor}; --focus-ring: ${brandColor}33;`}
              >
                {field.options?.map((option) => (
                  <option>{option}</option>
                ))}
              </select>
            ) : (
              <input
                id={field.id}
                name={field.name}
                type={field.type}
                required={field.required}
                class="mt-1 block w-full px-4 py-2 rounded-md shadow-sm input-base"
                style={`--focus-color: ${brandColor}; --focus-ring: ${brandColor}33;`}
              />
            )}
          </div>
        ))
      }
    </div>

    <button
      id="submitButton"
      type="submit"
      class="w-full py-3 px-4 rounded-md shadow-lg text-lg font-semibold text-white transition duration-150 ease-in-out transform hover:scale-105"
      style={`background-color: ${brandColor};`}
    >
      {submitLabel}
    </button>
  </form>
</div>

<script>
  const form = document.getElementById("teklifForm");
  const submitButton = form.querySelector('button[type="submit"]');
  const originalButtonText = submitButton.textContent;

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    submitButton.disabled = true;
    submitButton.textContent = "Gönderiliyor...";

    fetch("https://formsubmit.co/ajax/info@sakaryakayasigorta.com", {
      method: "POST",
      body: JSON.stringify(data),
      headers: {
        "Content-Type": "application/json",
        Accept: "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        alert("Form başarıyla gönderildi!");
        window.location.reload();
      })
      .catch((error) => {
        console.error("Form gönderilirken hata oluştu:", error);
        alert("Form gönderilirken bir hata oluştu. Lütfen tekrar deneyin.");
        submitButton.disabled = false;
        submitButton.textContent = originalButtonText;
      });
  });
</script>
